# encrypt_ami

[![Build Status](https://img.shields.io/travis/alexharv074/encrypt_ami.svg)](https://travis-ci.org/alexharv074/encrypt_ami)

## Overview

This repo contains scripts written in both Python and AWS CLI for encrypting an Amazon AMI using either a simple [copy-image](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/ec2.html#EC2.Client.copy_image) call, if the source and target accounts are the same; or by booting, stopping and then copying on the stopped AMI, and encrypting, otherwise.

Note that this also contains an example of using the Python Placebo library to unit test Python Boto3 scripts. See also my [blog post](https://alexharv074.github.io/2019/01/26/retrofitting-tests-to-a-python-boto3-script-using-unittest-and-placebo.html).

## Using the scripts

### share_ami.sh

The Share AMI script is for sharing an AMI from the source account to one or more destination accounts.

```text
<%= %x{bash share_ami.sh -h} -%>
```

### encrypt_ami.sh

The Bash version is `encrypt_ami.sh`.

```text
<%= %x{bash encrypt_ami.sh -h} -%>
```

### encrypt_ami.py

The Python version is `encrypt_ami.py`.

```text
<%= %x{python encrypt_ami.py -h} -%>
```

## Running the tests

To run the tests:

```text<%= %x{make help}.gsub(/\[\d+m/,"") -%>
```
